!function(){"use strict";const e=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i||(i=Math.random().toString(36).substr(2,5)),`${e}.${i}`},i=function(e,i){e&&i&&("string"==typeof i&&(i=i.split(" ")),i.forEach((i=>{e.classList.add(i)})))},t=function(e,i){e&&i&&("string"==typeof i&&(i=i.split(" ")),i.forEach((i=>{e.classList.remove(i)})))},s=function(e,i){let t=e.querySelectorAll(`[name="${i}"]`);const s=e.querySelectorAll(`[name="${i}[]"]`);return s.length&&(t=s),t},r=function(e){return`fields[${e=e.replace("{field:","").replace("{","").replace("}","").replace("]","").split("[").join("][")}]`};class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initialized=!1,this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.successClass=this.form.getClasses("success"),this.successMessageClass=this.form.getClasses("successMessage"),this.errorClass=this.form.getClasses("error"),this.errorMessageClass=this.form.getClasses("errorMessage"),this.isVisible=!1;const i=new IntersectionObserver((e=>{0==e[0].intersectionRatio?(this.isVisible=!1,this.initialized&&this.onHide()):(this.isVisible=!0,this.initialized&&this.onShow())}),{root:this.$form});setTimeout((()=>{i.observe(this.$field)}),500)}removeSuccess(){t(this.$field,this.successClass);const e=this.$field.querySelector(`.${this.successMessageClass}`);e&&e.remove()}addSuccess(e){i(this.$field,this.successClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add success message.");const s=document.createElement("div");s.className=this.successMessageClass,s.textContent=e,t.appendChild(s)}removeError(){t(this.$field,this.errorClass);const e=this.$field.querySelector(`.${this.errorMessageClass}`);e&&e.remove()}addError(e){i(this.$field,this.errorClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add error message.");const s=document.createElement("div");s.className=this.errorMessageClass,s.textContent=e,t.appendChild(s),this.submitHandler&&this.submitHandler.formSubmitError()}updateInputs(e,i){const t=this.$field.querySelector(`[name*="${e}"]`);t&&(t.value=i)}getBillingData(){if(!this.billingDetails)return{};const e={};if(this.billingDetails.billingName){const i=this.getFieldValue(this.billingDetails.billingName);i&&(e.name=i)}if(this.billingDetails.billingEmail){const i=this.getFieldValue(this.billingDetails.billingEmail);i&&(e.email=i)}if(this.billingDetails.billingAddress){e.address={};const i=this.getFieldValue(`${this.billingDetails.billingAddress}[address1]`),t=this.getFieldValue(`${this.billingDetails.billingAddress}[address2]`),s=this.getFieldValue(`${this.billingDetails.billingAddress}[address3]`),r=this.getFieldValue(`${this.billingDetails.billingAddress}[city]`),l=this.getFieldValue(`${this.billingDetails.billingAddress}[zip]`),a=this.getFieldValue(`${this.billingDetails.billingAddress}[state]`),n=this.getFieldValue(`${this.billingDetails.billingAddress}[country]`);i&&(e.address.line1=i),t&&(e.address.line2=t),s&&(e.address.line3=s),r&&(e.address.city=r),l&&(e.address.postal_code=l),a&&(e.address.state=a),n&&(e.address.country=n)}new CustomEvent("modifyBillingDetails",{bubbles:!0,detail:{provider:this,billing:e}});return{billing_details:e}}getFieldValue(e){return function(e,i){let t="";i=r(i);const l=s(e,i);return l&&l.forEach((e=>"checkbox"!==e.type&&"radio"!==e.type||e.checked?t=e.value:void 0)),t}(this.$form,e)}getFieldLabel(e){return function(e,i){let t="";i=r(i);const l=s(e,i);return l&&l.forEach((e=>{const i=e.closest("[data-field-type]");if(i){const e=i.querySelector("[data-field-label]");e&&(t=e.childNodes[0].textContent?.trim()??"")}})),t}(this.$form,e)}onShow(){}onHide(){}processResubmit(){this.form.config.Formie.refreshFormTokens(this.form),this.submitHandler.processSubmit(["payment"])}}window.FormiePaymentProvider=l;window.FormiePayWay=class extends l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.$input=this.$field.querySelector("[data-fui-payway-button]"),this.$input?(this.publishableKey=e.publishableKey,this.currency=e.currency,this.amountType=e.amountType,this.amountFixed=e.amountFixed,this.amountVariable=e.amountVariable,this.paywayScriptId="FORMIE_PAYWAY_SCRIPT",this.publishableKey?this.initialized=!0:console.error("Missing publishableKey for PayWay.")):console.error("Unable to find PayWay placeholder for [data-fui-payway-button]")}onShow(){this.initField()}onHide(){this.onAfterSubmit(),this.form.removeEventListener(e("onFormiePaymentValidate","payway")),this.form.removeEventListener(e("onAfterFormieSubmit","payway"))}initField(){if(document.getElementById(this.paywayScriptId))(function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;const t=Date.now(),s=function(r,l){window[e]?r(window[e]):i&&Date.now()-t>=i?l(new Error("timeout")):setTimeout(s.bind(this,r,l),30)};return new Promise(s)})("payway").then((()=>{this.mountCard()}));else{const e=document.createElement("script");e.id=this.paywayScriptId,e.src="https://api.payway.com.au/rest/v1/payway.js",e.async=!0,e.defer=!0,e.onload=()=>{this.mountCard()},document.body.appendChild(e)}this.form.addEventListener(this.$form,e("onFormiePaymentValidate","payway"),this.onValidate.bind(this)),this.form.addEventListener(this.$form,e("onAfterFormieSubmit","payway"),this.onAfterSubmit.bind(this))}mountCard(){payway.createCreditCardFrame({layout:"wide",publishableApiKey:this.publishableKey,tokenMode:"callback"},((e,i)=>{e?console.error(`Error creating frame: ${e.message}`):this.creditCardFrame=i}))}onValidate(e){"submit"!==this.form.submitAction||e.detail.invalid||(e.preventDefault(),this.submitHandler=e.detail.submitHandler,this.removeError(),this.creditCardFrame?this.creditCardFrame.getToken(((e,i)=>{e?(console.error(`Error getting token: ${e.message}`),this.addError(e.message)):(this.updateInputs("paywayTokenId",i.singleUseTokenId),this.submitHandler.submitForm())})):console.error("Credit Card Frame is invalid."))}onAfterSubmit(e){this.creditCardFrame&&(this.creditCardFrame.destroy(),this.creditCardFrame=null),this.updateInputs("paywayTokenId","")}}}();